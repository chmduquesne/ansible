#jinja2: lstrip_blocks: True
[Interface]
PrivateKey = {{ conf.privkey }}
ListenPort = {{ conf.listenport }}
{% for peer in peers %}
    {% set peervars = hostvars[peer] %}
    {% if net in peervars.wireguard %}
        {% set peerconf = peervars.wireguard[net]%}

[Peer]
PublicKey = {{ peerconf.pubkey }}
AllowedIPs = {{ peerconf.allowed_ips }}
        {% if peerconf.public | default(false) %}
Endpoint = {{ peervars.ansible_host }}:{{ peerconf.listenport }}
PersistentKeepalive = 20
        {% endif %}
    {% endif %}
{% endfor %}
